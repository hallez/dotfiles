#!/bin/bash
#
# Bash it
#
# This install Bash-it, the community bash framework.

set -euf -o pipefail

MY_DIR="$( cd "$( dirname "${BASH_SOURCE[0]}" )" && pwd )"

bashit_dir="$HOME/.bash_it"

aliases_file="${MY_DIR}/aliases"
completions_file="${MY_DIR}/completions"
plugins_file="${MY_DIR}/plugins"

if [[ ! -e "${bashit_dir}" ]]; then
  echo "  Cloning Bash it."
  git clone https://github.com/Bash-it/bash-it.git "${bashit_dir}"
else
  echo "  Updating Bash it."
  pushd "${bashit_dir}"
    git pull
  popd
fi

echo "  Installing Bash it."
pushd "${bashit_dir}"
  set +o pipefail
  yes | ./install.sh --none
  set -o pipefail
popd

set +u

set +ef
source "${bashit_dir}"/bash_it.sh
set -e

while read completion; do
    [[ -z "${completion}" ]] && continue

    echo "  Enabling completion: ${completion}."
    bash-it enable completion "${completion}"
done < "${completions_file}"

while read alias; do
    [[ -z "${alias}" ]] && continue

    echo "  Enabling alias: ${alias}."
    bash-it enable alias "${alias}"
done < "${aliases_file}"

while read plugin; do
    [[ -z "${plugin}" ]] && continue

    echo "  Enabling plugin: ${plugin}."
    bash-it enable plugin "${plugin}"
done < "${plugins_file}"

echo "  Installing custom bash aliases etc."
rm -rf "$HOME/.bash_aliases"
ln -s "${MY_DIR}/.bash_aliases" "$HOME/.bash_aliases"
echo -e "\n# Load custom aliases\n[[ -r $HOME/.bash_aliases ]] && source $HOME/.bash_aliases" >> "$HOME/.bash_profile"

rm -rf "$HOME/.inputrc"
ln -s "${MY_DIR}/.inputrc" "$HOME/.inputrc"
echo "  Installing custom bash aliases etc - done."
